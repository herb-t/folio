<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="portfolio-loader.html">
<link rel="import" href="shared-styles.html">

<dom-module id="list-page">
  <template>
    <style include="shared-styles">
      :host {
        display: none;
      }

      :host([active]) {
        display: block;
      }

      :host .l-content-container {
        max-width: 1120px;
      }

      /* .post {
        position: relative;
        margin-bottom: 100px;
        display: inline-block;
        max-width: 300px;
        overflow: hidden;
      }

      .post a {
        display: block;
        text-decoration: none;
        color: #212121;
      }

      p {
        font: 400 18px/33.18px "Open Sans", sans-serif;
      }

      :host {
        display: block;
        margin: 20px 0;
      } */

      .works-list {
        @apply --layout-horizontal;
        @apply --layout-wrap;
        margin-bottom: 32px;
      }

      a {
        margin: 0;
        padding: 0;
        text-align: center;
        text-decoration: none;
        -ms-flex: 1 1 100%;
        -webkit-flex: 1 1 100%;
        flex: 1 1 100%;
        -webkit-flex-basis: 100%;
        flex-basis: 100%;
      }
      img {
        -webkit-transition: opacity 0.3s ease-in-out;
           -moz-transition: opacity 0.3s ease-in-out;
            -ms-transition: opacity 0.3s ease-in-out;
             -o-transition: opacity 0.3s ease-in-out;
                transition: opacity 0.3s ease-in-out;

      }
      a:hover > figure img {
        opacity: 0.15;
      }
      a:hover > figure span {
        opacity: 1;
      }
      figure {
        padding: 0;
        margin: 0;
        position: relative;
      }

      figure img {
        width: 100%;
        max-width: 325px;
        height: auto;
      }
      /*
      figure iron-image {
        --iron-image-width: 100%;
      }
      */
      figcaption {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 100%;
        z-index: 1;
        -webkit-transform: translate(-50%, -50%);
           -moz-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
             -o-transform: translate(-50%, -50%);
                transform: translate(-50%, -50%);
      }
      span {
        font: 700 18px/32px 'Open Sans', sans-serif;
        color: black;
        opacity: 0;
        width: 100%;
        letter-spacing: 1px;
        -webkit-transition: opacity 0.3s ease-in-out;
           -moz-transition: opacity 0.3s ease-in-out;
            -ms-transition: opacity 0.3s ease-in-out;
             -o-transition: opacity 0.3s ease-in-out;
                transition: opacity 0.3s ease-in-out;
      }

      #list__footer {
        opacity: 0;
        visibility: hidden;
      }

      @media (min-width: 600px) {
        a {
          -ms-flex: 1 1 50%;
          -webkit-flex: 1 1 50%;
          flex: 1 1 50%;
          -webkit-flex-basis: 50%;
          flex-basis: 50%;
        }
      }

      @media (min-width: 900px) {
        a {
          -ms-flex: 1 1 33.333333%;
          -webkit-flex: 1 1 33.333333%;
          flex: 1 1 33.333333%;
          -webkit-flex-basis: 33.333333%;
          flex-basis: 33.333333%;
        }
      }

    </style>

    <iron-ajax
      auto
      url="[[_computeURL(category)]]"
      handle-as="json"
      loading="{{loading}}"
      on-response="_onResponse"
      last-response="{{postList}}"></iron-ajax>
    
    <portfolio-loader id="list__loader"></portfolio-loader>
    <main class="l-content-container works-list">
      <template is="dom-repeat" items="{{postList.posts}}">

        <a href="#/[[category]]/posts/[[item.slug]]" class="list__card">
          <figure>

            <!-- <iron-image preload fade src="[[item.img]]" alt="[[item.img_alt]]"></iron-image> -->
            <img src="[[item.img]]" alt="[[item.img_alt]]">

            <figcaption>
              <span>{{item.title}}</span>
            </figcaption>

          </figure>
        </a>
      </template>
    </main>
    <portfolio-footer id="list__footer"></portfolio-footer>
  </template>

  <script>
    class ListPageElement extends Polymer.Element {
      static get is() { return 'list-page'; }

      static get properties() {
        return {
          active: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          },
          postList: {
            type: Array
          },
          _loaded: {
            type: Boolean,
            value: false,
            notify: true
          },
          loading: {
            type: Boolean,
            value: false,
            notify: true
          }
        };
      }

      _computeURL(category) {
        return `data/list/${category}.json`;
      }

      connectedCallback() {
        super.connectedCallback();
      }

      _onResponse() {

        
        if (this.postList.posts.length > 8) {
          //let cards = Array.prototype.slice.call(this.queryAllEffectiveChildren('.list__card'));
          //console.log(cards)
          TweenMax.to(this.$.list__loader, 0.4, {delay: 0.3, autoAlpha: 0, ease: Power1.easeOut});
          TweenMax.to(this.$.list__footer, 0.6, {autoAlpha: 1, ease: Power4.easeOut});
          //TweenMax.staggerTo(cards, 0.8, {delay: 1, autoAlpha: 0, y: 20, ease: Power4.easeOut}, 0.05);
        }
      }

    }

    window.customElements.define(ListPageElement.is, ListPageElement);
  </script>
</dom-module>
